---
title: "R for Planning. Week One"
author: "Henry Renski"
date: "9/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Week One

### Exploring R for Data Analysis and Visualization

Our objective for today is to simply get a feel for R and the R Studio interface. Today we will run through some of the basic features in R in what is a very common type of project workflow. In today's exercise we will do the following:

1.  Exploring the R Studio interface

2.  Install and load the packages

3.  Download data from American Community Survey through the Census Bureau API server

4.  Format the data and calculate some summary statistics

5.  Display some of our results in a formatted Table

6.  Make and format some descriptive charts

7.  Make a map showing the spatial distribution of some variables

I'll be proving the code for you to run. Its OK if you don't understand what we are doing. Over the course of the semester, we will be exploring these (and other) functions in much greater detail.

Note: I have written these instructions is a package called R Markdown, which makes nice documents that allow you to interweave narrative, code and charts. This is referred to as literate coding or literate programming.

### 1: Exploring the R Studio Interface

Let's look at the four windows in R.

The gray chunk below is a code block. You can issue simple commands into the console, and its where you will find messages and some printed output. I want you to copy and paste the code below into the console

```{r}
1+1


```

Open a new "R script" file.

### 2: Install and load packages

While everything can be done in R's base code, most people use a variety of "packages" for analysis. Packages are blocks of code written by other users. You have to install the packages (and then load) the you want to use each time you run code. There are thousands upon thousands of packages in R, and they all have their on syntax and grammar. However, there are some packages that you wind up using all the time, and those once you master those few you will be fine.

Let's load the packages you will need for today.

Open a new "R script" file. Then copy and paste the following code into the file. Then highlight and run the code.

```{r set up, eval=FALSE}

#code below to install packages
install.packages("tidyverse")  #suite including many of the best data munipilation and visualization functions

install.packages("tidycensus")  #pulls ACS data off the census bureau API, works well with dplyr and ggplot but doesn't cover all census data products

install.packages("tigris")      #pulls GIS files directly from census TIGER server, integrated with tidycensus

install.packages("viridis")   #includes some pre-fabbed color scheme for mapping
```

Packages typically only need to be installed one time (per computer). However, your desired packages will need to be "loaded" each time you start a new R session. The next code chunk loads the required packages.

```{r, eval=false}

library(tidyverse)
library(tidycensus)
library(tigris)
library(viridis)

```

We can see if the package was loaded in the lower right window and choosing the "Packages" tab.

## Accessing Data through the Census API

Rather than download data onto your computer, why not work with it directly from the Census Bureau's servers? That's the point behind working with an API. We will use the **tidycensus** package to access the American Community Survey API and the associated **tigris** package to access the spatial files (for mapping).

To get started working with **tidycensus**, users must first get a Census API key. The API key is like a password that you need to access census data. A key can be obtained from [\<http://api.census.gov/data/key_signup.html\>](http://api.census.gov/data/key_signup.html){.uri}. You only need to sign up for it once, as long as you store the code in a place you remember for future use.

```{r}

census_api_key("YOUR API KEY GOES HERE")

#census_api_key("9eac35e5489829fedcaaf690f14d2ec112dd69ab")
```

Let's download income data for Massachusetts Census from the most recent 5 year ACS.

```{r}
MA.tract.inc <- get_acs(geography = "tract", variables = "B19013_001",
                state = "MA", geometry = TRUE)


MA.tract.inc <- get_acs(geography = "tract", variables = "B19013_001",
                state = "MA")
```

Note: the geometry=TRUE option downloads GIS files along with the data.

Let's look at the dataset from the environment window,

### Calculating Summary Statistics using dplyr (part of tidyverse)

Let's calculate the mean and median of tract-level income. We will then store these variables in objects for future access.

```{r}
mean <- as.data.frame(MA.tract.inc) %>% 
  summarise(mean_inc = mean(estimate, na.rm=TRUE))

median <- as.data.frame(MA.tract.inc) %>% 
  summarise(mean_inc = median(estimate, na.rm=TRUE))

```

### Making Charts and Graphs using ggplot2 (part of tidyverse)

Mapping Data

Let's map the data

```{r}

ggplot(MA.tract.inc, aes(fill = estimate, color = estimate)) +
  geom_sf() +
  coord_sf(crs = 26987) +
  scale_fill_viridis(option = "viridis", direction=-1) +
  scale_color_viridis(option = "viridis", direction=-1) 


```

Let's create a histogram of the distribution of incomes by tract

```{r}
ggplot(JTW) + geom_histogram(mapping = aes(x = Home_per), bins=10)

```

Let's calculate the mean and the median

Let's download income data for Massachusetts Census from the most recent 5 year ACS.

```{r cars}
  
mutate(NAME = gsub(" County, Vermont", "", NAME)) %>%
 ggplot(aes(x = estimate, y = reorder(NAME, estimate))) +
  geom_errorbarh(aes(xmin = estimate - moe, xmax = estimate + moe)) +
  geom_point(color = "red", size = 3) +
  labs(title = "Household income by county in Vermont",
       subtitle = "2015-2019 American Community Survey",
       y = "",
       x = "ACS estimate (bars represent margin of error)")


```

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
